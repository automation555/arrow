# Additions to Arrow Python Documentation

This directory contains reStructured text files that provide a central place to create supplemental and override documentation for autogenerated documentation. This is not intended to be build directly or to stand alone and by itself.

The `pyarrow` package autogenerates documentation for the functions in the C++ library that are called via Cython, but this documentation is (necessarily) very generic, has no python examples, and is often missing relevant information for which python types are valid for parameters or details for how they are marshalled.

So, this `python/docs/additions` path is a place where *additional* reStructured text documentation can be stored on a per-function basis. It doe not contain complete and full documentation. Instead:

1. It provide a centralize place to write readable additions/overrides to the default documentation generated from Arrow C++
2. It allows for testing of exaple code using doctest to ensure it runs and is correct.
3. It is referenced by the `pyarrow.docutils` module to build a data structure of document parts that can be combined with the Arrow C++ documentation. 

## Testing code examples

All of the code examples should be encased in python code-blocks so that they can be tested.  To run the tets on a single file or set of files, run something like:

```bash
python -m doctest docs/additions/compute/count_indices.rst

python -m doctest docs/additions/compute/*rst

find docs/additions/ -iname '*rst' -exec python -m doctest {} +
```

## Valid Structure

The following structure is supposed in the individual reStructured text additions.  

* A comment tag (`.. comment::`) or a comment section is for meta-commentary on your intent for the documentation itself - these will **not** be rendered in the final docs.
* A **Description** section overwrite the default *Description* provided by the Arrow C++ docs.
* A **Details** section preserves the default *Description* but add the block to it afterward.
* A **Parameters** section must be in reStructured definition format. These will overwrite the details for the given parameter. Classifiers will be used as the parameter type.
* A **Returns** section must be in reStructured definition format. The return type should be the definition term and the definition the descriptive text. Any classifiers are ignored.
* An **Examples** section is to add a new section.

### Idiosyncracies of Restructured Text

The reStructed text specification has several limitations that dictate the structure of the doc additions:

1. reStructured text does not allow for multiple sections with the same name, even if they are subsections in different top-level sections; we therefore cannot include multiple functions in a single file.
2. `subtitle`, and `section` tags are both defined by creating headings; the difference is that a `subtitle` should not have another heading with the same level and a `section` tag should. Therefore, creating a doc addition with only 1 `section` gets interpreted as a `subtitle` by `docutils`. This is handled in the `pyarrow.docutils` module.
3. `doctest` will fail for code block result lines that have a trailing whitespace character.

## How this code is used 

As noted, the `rst` documentation here are for additions that are combined with the generic document defined by Arrow C++. 

For the example case of the `pyarrow.compute` functions, the `generate_compute_function_doc` function in the `scripts/generate_sources.py` script assessbles the function docstrings for the pyarrow.compute functions as so:

* A barebones default documentation is generated from the C++ function definition.
* Descriptive documentation is defined as `FunctionDoc` objects in the `cpp/src/arrow` repository directory tree.
* A reStructured text file in `/docs/additions` with the same function name will be parsed using `docutils` and combined with the default documentation.
* The full docstring string is returned by `generate_compute_function_doc`
